{% extends "base.html" %}

{% block title %}Campaign Management - PegaSpy{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-bullseye"></i> Campaign Management</h2>
    <div class="btn-group" role="group">
        <button class="btn btn-primary" onclick="createCampaign()">
            <i class="fas fa-plus"></i> New Campaign
        </button>
        <button class="btn btn-info" onclick="importCampaign()">
            <i class="fas fa-upload"></i> Import
        </button>
        <button class="btn btn-warning" onclick="exportCampaigns()">
            <i class="fas fa-download"></i> Export
        </button>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title">Active Campaigns</h5>
                <h2 class="text-success" id="activeCampaigns">{{ campaigns.active }}</h2>
                <small class="text-muted">Running</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title">Total Targets</h5>
                <h2 class="text-info" id="totalTargets">{{ campaigns.total_targets }}</h2>
                <small class="text-muted">Across all campaigns</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title">Success Rate</h5>
                <h2 class="text-warning" id="successRate">{{ campaigns.success_rate }}%</h2>
                <small class="text-muted">Overall</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h5 class="card-title">Data Collected</h5>
                <h2 class="text-success" id="dataCollected">{{ campaigns.data_collected }}</h2>
                <small class="text-muted">Total</small>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-list"></i> Campaign List</h5>
                    <div class="input-group" style="width: 300px;">
                        <input type="text" class="form-control" placeholder="Search campaigns..." id="campaignSearch">
                        <button class="btn btn-outline-success" onclick="searchCampaigns()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-dark table-hover" id="campaignsTable">
                        <thead>
                            <tr>
                                <th>Campaign Name</th>
                                <th>Status</th>
                                <th>Targets</th>
                                <th>Success Rate</th>
                                <th>Created</th>
                                <th>Last Activity</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-bullseye text-success me-2"></i>
                                        <div>
                                            <strong>Operation Phoenix</strong>
                                            <br><small class="text-muted">High-value targets</small>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>23/25</td>
                                <td><span class="text-success">87.5%</span></td>
                                <td>2024-01-15</td>
                                <td>2 min ago</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-info" onclick="viewCampaign('phoenix')" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="editCampaign('phoenix')" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="pauseCampaign('phoenix')" title="Pause">
                                            <i class="fas fa-pause"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="deleteCampaign('phoenix')" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-mobile-alt text-warning me-2"></i>
                                        <div>
                                            <strong>Mobile Sweep</strong>
                                            <br><small class="text-muted">iOS/Android targets</small>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="badge bg-warning">Paused</span></td>
                                <td>45/50</td>
                                <td><span class="text-warning">72.1%</span></td>
                                <td>2024-01-10</td>
                                <td>1 hour ago</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-info" onclick="viewCampaign('mobile')" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="editCampaign('mobile')" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="resumeCampaign('mobile')" title="Resume">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="deleteCampaign('mobile')" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-globe text-info me-2"></i>
                                        <div>
                                            <strong>Global Recon</strong>
                                            <br><small class="text-muted">Intelligence gathering</small>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="badge bg-info">Scheduled</span></td>
                                <td>0/100</td>
                                <td><span class="text-muted">-</span></td>
                                <td>2024-01-20</td>
                                <td>Never</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-info" onclick="viewCampaign('recon')" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-warning" onclick="editCampaign('recon')" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="startCampaign('recon')" title="Start">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="deleteCampaign('recon')" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Creation Modal -->
<div class="modal fade" id="createCampaignModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark">
            <div class="modal-header border-success">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Create New Campaign</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createCampaignForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="campaignName" class="form-label">Campaign Name</label>
                                <input type="text" class="form-control" id="campaignName" placeholder="Enter campaign name" required>
                            </div>
                            <div class="mb-3">
                                <label for="campaignDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="campaignDescription" rows="3" placeholder="Campaign description"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="campaignType" class="form-label">Campaign Type</label>
                                <select class="form-select" id="campaignType">
                                    <option value="targeted">Targeted Attack</option>
                                    <option value="mass">Mass Exploitation</option>
                                    <option value="recon">Reconnaissance</option>
                                    <option value="persistence">Persistence Testing</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="campaignPriority" class="form-label">Priority</label>
                                <select class="form-select" id="campaignPriority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="exploitTypes" class="form-label">Exploit Types</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="imessageExploit" checked>
                                    <label class="form-check-label" for="imessageExploit">iMessage Zero-Click</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="whatsappExploit">
                                    <label class="form-check-label" for="whatsappExploit">WhatsApp Media</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="telegramExploit">
                                    <label class="form-check-label" for="telegramExploit">Telegram Sticker</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="browserExploit">
                                    <label class="form-check-label" for="browserExploit">Browser Zero-Day</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="targetPlatforms" class="form-label">Target Platforms</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="iosTarget" checked>
                                    <label class="form-check-label" for="iosTarget">iOS</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="androidTarget">
                                    <label class="form-check-label" for="androidTarget">Android</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="windowsTarget">
                                    <label class="form-check-label" for="windowsTarget">Windows</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="macosTarget">
                                    <label class="form-check-label" for="macosTarget">macOS</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <h6 class="text-success mb-3">Advanced Configuration</h6>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="stealthLevel" class="form-label">Stealth Level</label>
                                <select class="form-select" id="stealthLevel">
                                    <option value="low">Low (Fast)</option>
                                    <option value="medium" selected>Medium (Balanced)</option>
                                    <option value="high">High (Slow)</option>
                                    <option value="maximum">Maximum (Ultra Slow)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="persistenceLevel" class="form-label">Persistence</label>
                                <select class="form-select" id="persistenceLevel">
                                    <option value="none">None</option>
                                    <option value="basic">Basic</option>
                                    <option value="advanced" selected>Advanced</option>
                                    <option value="kernel">Kernel Level</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="selfDestruct" class="form-label">Self-Destruct</label>
                                <select class="form-select" id="selfDestruct">
                                    <option value="disabled">Disabled</option>
                                    <option value="timer">Timer Based</option>
                                    <option value="trigger" selected>Trigger Based</option>
                                    <option value="remote">Remote Command</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="startDate" class="form-label">Start Date</label>
                                <input type="datetime-local" class="form-control" id="startDate">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="endDate" class="form-label">End Date (Optional)</label>
                                <input type="datetime-local" class="form-control" id="endDate">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-success">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveCampaign()">Create Campaign</button>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Details Modal -->
<div class="modal fade" id="campaignDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark">
            <div class="modal-header border-success">
                <h5 class="modal-title"><i class="fas fa-eye"></i> Campaign Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><i class="fas fa-chart-line"></i> Campaign Progress</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="campaignProgressChart" height="100"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-list"></i> Target Status</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark table-sm">
                                        <thead>
                                            <tr>
                                                <th>Target ID</th>
                                                <th>Platform</th>
                                                <th>Status</th>
                                                <th>Progress</th>
                                                <th>Last Update</th>
                                            </tr>
                                        </thead>
                                        <tbody id="campaignTargetsTable">
                                            <!-- Dynamic content -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><i class="fas fa-info-circle"></i> Campaign Info</h6>
                            </div>
                            <div class="card-body">
                                <div id="campaignInfo">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6><i class="fas fa-cogs"></i> Quick Actions</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success btn-sm" onclick="addTargetsToCampaign()">
                                        <i class="fas fa-plus"></i> Add Targets
                                    </button>
                                    <button class="btn btn-warning btn-sm" onclick="pauseResumeCampaign()">
                                        <i class="fas fa-pause"></i> Pause/Resume
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="exportCampaignData()">
                                        <i class="fas fa-download"></i> Export Data
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="emergencyStop()">
                                        <i class="fas fa-stop"></i> Emergency Stop
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-clock"></i> Recent Activity</h6>
                            </div>
                            <div class="card-body">
                                <div id="campaignActivity" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let currentCampaign = null;
let campaignProgressChart = null;

function createCampaign() {
    // Set default start date to now
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('startDate').value = now.toISOString().slice(0, 16);
    
    new bootstrap.Modal(document.getElementById('createCampaignModal')).show();
}

function saveCampaign() {
    const formData = {
        name: document.getElementById('campaignName').value,
        description: document.getElementById('campaignDescription').value,
        type: document.getElementById('campaignType').value,
        priority: document.getElementById('campaignPriority').value,
        exploits: {
            imessage: document.getElementById('imessageExploit').checked,
            whatsapp: document.getElementById('whatsappExploit').checked,
            telegram: document.getElementById('telegramExploit').checked,
            browser: document.getElementById('browserExploit').checked
        },
        platforms: {
            ios: document.getElementById('iosTarget').checked,
            android: document.getElementById('androidTarget').checked,
            windows: document.getElementById('windowsTarget').checked,
            macos: document.getElementById('macosTarget').checked
        },
        stealth: document.getElementById('stealthLevel').value,
        persistence: document.getElementById('persistenceLevel').value,
        selfDestruct: document.getElementById('selfDestruct').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value
    };
    
    if (!formData.name) {
        alert('Campaign name is required');
        return;
    }
    
    // Simulate API call
    console.log('Creating campaign:', formData);
    
    // Close modal and refresh table
    bootstrap.Modal.getInstance(document.getElementById('createCampaignModal')).hide();
    
    // Add new row to table (simulation)
    addCampaignToTable(formData);
    
    alert('Campaign created successfully!');
}

function addCampaignToTable(campaign) {
    const tbody = document.querySelector('#campaignsTable tbody');
    const row = document.createElement('tr');
    
    const statusBadge = campaign.startDate <= new Date().toISOString() ? 
        '<span class="badge bg-success">Active</span>' : 
        '<span class="badge bg-info">Scheduled</span>';
    
    row.innerHTML = `
        <td>
            <div class="d-flex align-items-center">
                <i class="fas fa-bullseye text-success me-2"></i>
                <div>
                    <strong>${campaign.name}</strong>
                    <br><small class="text-muted">${campaign.description || 'No description'}</small>
                </div>
            </div>
        </td>
        <td>${statusBadge}</td>
        <td>0/0</td>
        <td><span class="text-muted">-</span></td>
        <td>${new Date().toISOString().split('T')[0]}</td>
        <td>Just now</td>
        <td>
            <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-info" onclick="viewCampaign('${campaign.name.toLowerCase().replace(/\s+/g, '_')}')" title="View">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-outline-warning" onclick="editCampaign('${campaign.name.toLowerCase().replace(/\s+/g, '_')}')" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline-success" onclick="startCampaign('${campaign.name.toLowerCase().replace(/\s+/g, '_')}')" title="Start">
                    <i class="fas fa-play"></i>
                </button>
                <button class="btn btn-outline-danger" onclick="deleteCampaign('${campaign.name.toLowerCase().replace(/\s+/g, '_')}')" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    `;
    
    tbody.appendChild(row);
}

function viewCampaign(campaignId) {
    currentCampaign = campaignId;
    
    // Populate campaign info
    const campaignInfo = document.getElementById('campaignInfo');
    campaignInfo.innerHTML = `
        <p><strong>Name:</strong> ${campaignId.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
        <p><strong>Status:</strong> <span class="badge bg-success">Active</span></p>
        <p><strong>Type:</strong> Targeted Attack</p>
        <p><strong>Priority:</strong> <span class="text-warning">High</span></p>
        <p><strong>Created:</strong> 2024-01-15</p>
        <p><strong>Targets:</strong> 23/25</p>
        <p><strong>Success Rate:</strong> <span class="text-success">87.5%</span></p>
        <p><strong>Data Collected:</strong> 2.3 GB</p>
    `;
    
    // Populate targets table
    const targetsTable = document.getElementById('campaignTargetsTable');
    targetsTable.innerHTML = `
        <tr>
            <td>TGT_001</td>
            <td>iOS 15.7</td>
            <td><span class="badge bg-success">Compromised</span></td>
            <td>
                <div class="progress" style="height: 15px;">
                    <div class="progress-bar bg-success" style="width: 100%">100%</div>
                </div>
            </td>
            <td>2 min ago</td>
        </tr>
        <tr>
            <td>TGT_002</td>
            <td>Android 12</td>
            <td><span class="badge bg-warning">In Progress</span></td>
            <td>
                <div class="progress" style="height: 15px;">
                    <div class="progress-bar bg-warning" style="width: 65%">65%</div>
                </div>
            </td>
            <td>5 min ago</td>
        </tr>
        <tr>
            <td>TGT_003</td>
            <td>iOS 14.8</td>
            <td><span class="badge bg-danger">Failed</span></td>
            <td>
                <div class="progress" style="height: 15px;">
                    <div class="progress-bar bg-danger" style="width: 25%">25%</div>
                </div>
            </td>
            <td>1 hour ago</td>
        </tr>
    `;
    
    // Populate activity log
    const activityLog = document.getElementById('campaignActivity');
    activityLog.innerHTML = `
        <div class="text-success">[12:34:56] Target TGT_001 compromised successfully</div>
        <div class="text-info">[12:33:21] Exploit payload delivered to TGT_002</div>
        <div class="text-warning">[12:32:45] Retry attempt #2 for TGT_003</div>
        <div class="text-success">[12:31:12] Data exfiltration completed: 45MB</div>
        <div class="text-info">[12:30:33] Campaign started</div>
    `;
    
    // Create progress chart
    createCampaignProgressChart();
    
    new bootstrap.Modal(document.getElementById('campaignDetailsModal')).show();
}

function createCampaignProgressChart() {
    const ctx = document.getElementById('campaignProgressChart').getContext('2d');
    
    if (campaignProgressChart) {
        campaignProgressChart.destroy();
    }
    
    campaignProgressChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
            datasets: [{
                label: 'Successful Exploits',
                data: [0, 3, 8, 15, 18, 21, 23],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4
            }, {
                label: 'Failed Attempts',
                data: [0, 1, 1, 2, 2, 2, 2],
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#00ff00' }
                },
                x: {
                    ticks: { color: '#00ff00' }
                }
            },
            plugins: {
                legend: {
                    labels: { color: '#00ff00' }
                }
            }
        }
    });
}

function editCampaign(campaignId) {
    alert(`Edit campaign: ${campaignId}`);
}

function startCampaign(campaignId) {
    if (confirm(`Start campaign: ${campaignId}?`)) {
        alert(`Campaign ${campaignId} started successfully!`);
        // Update status in table
        updateCampaignStatus(campaignId, 'Active', 'bg-success');
    }
}

function pauseCampaign(campaignId) {
    if (confirm(`Pause campaign: ${campaignId}?`)) {
        alert(`Campaign ${campaignId} paused.`);
        updateCampaignStatus(campaignId, 'Paused', 'bg-warning');
    }
}

function resumeCampaign(campaignId) {
    if (confirm(`Resume campaign: ${campaignId}?`)) {
        alert(`Campaign ${campaignId} resumed.`);
        updateCampaignStatus(campaignId, 'Active', 'bg-success');
    }
}

function deleteCampaign(campaignId) {
    if (confirm(`Delete campaign: ${campaignId}? This action cannot be undone.`)) {
        if (confirm('Are you absolutely sure? All campaign data will be lost.')) {
            alert(`Campaign ${campaignId} deleted.`);
            // Remove row from table
            // Implementation would remove the actual row
        }
    }
}

function updateCampaignStatus(campaignId, status, badgeClass) {
    // Find and update the status badge in the table
    // This is a simplified implementation
    console.log(`Updated ${campaignId} status to ${status}`);
}

function searchCampaigns() {
    const searchTerm = document.getElementById('campaignSearch').value.toLowerCase();
    const rows = document.querySelectorAll('#campaignsTable tbody tr');
    
    rows.forEach(row => {
        const campaignName = row.querySelector('strong').textContent.toLowerCase();
        if (campaignName.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

function importCampaign() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json,.xml,.csv';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            alert(`Importing campaign from: ${file.name}`);
            // Implementation would parse and import the file
        }
    };
    input.click();
}

function exportCampaigns() {
    if (confirm('Export all campaigns? This may take a few minutes.')) {
        alert('Campaign export initiated. Download will start shortly.');
        
        // Simulate export
        setTimeout(() => {
            const filename = `pegaspy_campaigns_${Date.now()}.json`;
            alert(`Campaigns exported: ${filename}`);
        }, 2000);
    }
}

function addTargetsToCampaign() {
    alert('Add targets functionality would open target selection dialog');
}

function pauseResumeCampaign() {
    alert('Pause/Resume functionality for current campaign');
}

function exportCampaignData() {
    alert('Export current campaign data');
}

function emergencyStop() {
    if (confirm('EMERGENCY STOP: This will immediately halt all campaign activities and trigger self-destruct protocols. Continue?')) {
        if (confirm('This action is IRREVERSIBLE. All active exploits will be terminated. Are you absolutely sure?')) {
            alert('EMERGENCY STOP ACTIVATED - All activities halted');
        }
    }
}

// Real-time updates
const socket = io();
socket.on('campaign_update', function(data) {
    console.log('Campaign update received:', data);
    // Update campaign statistics and tables
});

// Initialize search functionality
document.getElementById('campaignSearch').addEventListener('keyup', function(e) {
    if (e.key === 'Enter') {
        searchCampaigns();
    }
});
</script>
{% endblock %}